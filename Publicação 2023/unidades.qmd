```{r}
source("_setup.R")
source("_carregamento.R")
source("_funcoes.R")
```

# Unidades do SUAS

Essa seção apresenta informações sobre as unidades físicas do SUAS e sua evolução ao longo do tempo. Esse item contempla as seguintes informações: quantidade de unidades administrativas da rede socioassistencial, informações sobre acessibilidade, situação do imovél e disponibilidade de equipamentos.

## Centros de Referência de Assistência Social (CRAS)

Os Centros de Referência de Assistência Social (CRAS) são definidos pelo Art. 6º-C da Lei Orgânica de Assistência Social (LOAS) como unidades públicas municipais destinadas à prestação de serviços, e a programas de projetos da proteção social básica às famílias, e devem estar localizados em áreas com maiores índices de vulnerabilidade e risco social.

No Censo SUAS de 2022 identificou, em 5.535 municípios, um aumento de undiades de CRAS entre os anos de 2007 e 2022, passando de 4.182 para 8.557. Número que mostra a existência de, pelo menos, um CRAS em 99,37% dos municípios brasileiros conforme @fig-quantitativo-CRAS.



```{r fig-quantitativo-CRAS, fig.cap = "Evolução do quantitativo de CRAS, segundo grandes regiões; 2007, 2012, 2017 e 2023", fig.footer = "Fonte: MDS, Censo SUAS."}

grafico <- 
#    f_quantitativo_regiao_ano(cras_2007, ibge, "2007") %>%
    f_quantitativo_regiao_ano(cras_2008, Região, "2008")%>%
#   bind_rows(f_quantitativo_regiao_ano(cras_2009, Região, "2009")) %>%
#   bind_rows(f_quantitativo_regiao_ano(cras_2010, Região, "2010")) %>%
#   bind_rows(f_quantitativo_regiao_ano(cras_2011, IBGE, "2011")) %>%
#   bind_rows(f_quantitativo_regiao_ano(cras_2012, Região, "2012")) %>%
   bind_rows(f_quantitativo_regiao_ano(cras_2013, Região, "2013")) %>%
#   bind_rows(f_quantitativo_regiao_ano(cras_2014, Região, "2014")) %>%
#   bind_rows(f_quantitativo_regiao_ano(cras_2015, Região, "2015")) %>%
#   bind_rows(f_quantitativo_regiao_ano(cras_2016, Região, "2016")) %>%
#   bind_rows(f_quantitativo_regiao_ano(cras_2017, Região, "2017")) %>%
   bind_rows(f_quantitativo_regiao_ano(cras_2018, IBGE, "2018")) %>%
#   bind_rows(f_quantitativo_regiao_ano(cras_2019, IBGE, "2019")) %>%
#   bind_rows(f_quantitativo_regiao_ano(cras_2020, IBGE, "2020")) %>%
#   bind_rows(f_quantitativo_regiao_ano(cras_2021, IBGE, "2021")) %>%
#  bind_rows(f_quantitativo_regiao_ano(cras_2022, IBGE, "2022")) %>%
  bind_rows(f_quantitativo_regiao_ano(cras_2023, IBGE, "2023")) %>%
  f_grafico_col_group_numero(Região, n, Ano, 1)

grafico
```


A Expansão do número de CRAS evidencia a consolidação das unidades públicas de Assistência Social como referência em todo o todo território nacional. De acordo com os dados, 99,37% municípios possuem CRAS, ou seja, apenas 34 municípios no Brasil não dispõem desta unidade pública[^unidades-1].

[^unidades-1]: estas informações são referentes ao preenchimento do Censo SUAS, é possível que no determinado período esta unidade pública não tenha preenchido o forumulário

```{r fig-municipios-CRAS, fig.cap = "Evolução do percentual de municípios com pelo menos um CRAS, segundo grandes regiões - Brasil, 2007 a 2017", fig.footer = "Fonte: MDS, Censo SUAS", eval=FALSE}

grafico <- f_percentual_municipios_regiao_ano(cras_2007, ibge, "2007") %>%
 # bind_rows(f_percentual_municipios_regiao_ano(cras_2008, IBGE, "2008")) %>%
 # bind_rows(f_percentual_municipios_regiao_ano(cras_2009, IBGE, "2009")) %>%
 # bind_rows(f_percentual_municipios_regiao_ano(cras_2010, ibge, "2010")) %>%
 # bind_rows(f_percentual_municipios_regiao_ano(cras_2011, IBGE, "2011")) %>%
 bind_rows(f_percentual_municipios_regiao_ano(cras_2012, IBGE, "2012")) %>%
 # bind_rows(f_percentual_municipios_regiao_ano(cras_2013, IBGE, "2013")) %>%
 # bind_rows(f_percentual_municipios_regiao_ano(cras_2014, IBGE, "2014")) %>%
 # bind_rows(f_percentual_municipios_regiao_ano(cras_2015, CD_IBGE, "2015")) %>%
 # bind_rows(f_percentual_municipios_regiao_ano(cras_2016, IBGE, "2016")) %>%
 bind_rows(f_percentual_municipios_regiao_ano(cras_2017, IBGE, "2017")) %>%
 # bind_rows(f_percentual_municipios_regiao_ano(cras_2018, IBGE, "2018")) %>%
 # bind_rows(f_percentual_municipios_regiao_ano(cras_2019, IBGE, "2019")) %>%
 # bind_rows(f_percentual_municipios_regiao_ano(cras_2020, IBGE, "2020")) %>%
 # bind_rows(f_percentual_municipios_regiao_ano(cras_2021, IBGE, "2021")) %>%
 bind_rows(f_percentual_municipios_regiao_ano(cras_2022, IBGE, "2022")) %>%

  ggplot(aes(x = Região, y = Percentual, group = Ano)) +
  geom_col(aes(fill = Ano), position="dodge") +
  geom_text(aes(label = percent(Percentual), y=Percentual+0.04), position = position_dodge(width = 0.9), angle = 90, size = 2.5) +
  scale_y_continuous(expand = expansion(mult = c(0, .1))) +
  theme(legend.position="bottom",
        legend.title = element_blank(),
        axis.title = element_blank(),
        axis.ticks = element_blank(),
        axis.text.y = element_blank(),
        axis.line.x = element_line(),
        panel.background = element_blank()) +
  guides(fill=guide_legend(nrow=1,byrow=TRUE))

grafico
```

Levando-se em conta o porte populacional, verifica-se que a maioria dos municípios que não possuem CRAS é de pequeno porte (35 municípios[^unidades-2]) (@fig-CRAS-porte).

[^unidades-2]: é possível também que alguns deles não tenham respondido ao Censo SUAS

No que se refere ao porte do municípios, verifica-se que os de Pequeno Porte I (96%) e Pequeno Porte II (70%), em sua maioria, têm uma unidade de CRAS como referência. Os de Médio Porte, cerca de 66%, possuem de 2 a 3 CRAS e os de Grande Porte (51%), grupo majoritário, têm entre 4 e 6 CRAS.

```{=html}
<!--esse grafico tana com dado de 2017, daí troquei para 2022 e desconfigurou
ATUALIZAÇÃO: O problema era que em 2022 Fernando de Noronha estava sem o código IBGE na base de CRAS, daí não era possivel determinar o porte do município e gerava uma categoria de município sem porte, e isto desconfigurava o gráfico gerado. Arrumada a base de CRAS de 2022 com inserção do código IBGE de Fernando de Noronha. Também foi atualizada a estimativa populacional para 2021. Dados do Censo de 2022 não foram encontrados em formato facilmente utilizável.-->
```
```{=html}
<!-- Sobre o número de famílias referenciadas a PNAS^[PNAS/2004 - Política Nacional de Assistência Social] deternima de acordo com portes populacionais dos municípios, são eles: PPI: 2.500 famílias referenciadas por CRAS, PPII: 3.500 famílias referenciadas, Médio/Grande/Metrópole: 5000 famílias referencia por CRAS.
CRAS -->
```
```{r fig-CRAS-porte, fig.cap = "Percentual de municípios por número de CRAS no município, segundo porte populacional estimado do município - Brasil, 2023", fig.footer = "Fonte: MDS, Censo SUAS; e IBGE, estimativas da população residente para os municípios"}

cras_municipios <- cras_2023 %>%
  select(IBGE7) %>%
  group_by(IBGE7) %>%
  summarise(n_cras=n())

porte_municipios <- pop_municipios_2021 %>%
  f_porte_populacional(`POPULAÇÃO ESTIMADA`) %>%
  mutate(IBGE7 = as.numeric(paste0(`COD. UF`, `COD. MUNIC`))) %>%
  select(IBGE7, Porte)

dados <- cras_municipios %>%
  full_join(porte_municipios, by = c("IBGE7" = "IBGE7")) %>%
  mutate(grupo = case_when(is.na(n_cras)~"Nenhum CRAS",
                            n_cras == 0~"Nenhum CRAS",
                            n_cras == 1~"1 CRAS",
                            n_cras <= 3~"De 2 a 3 CRAS",
                            n_cras <= 6~"De 4 a 6 CRAS",
                            n_cras <= 10~"De 7 a 10 CRAS",
                            n_cras > 10~"Mais de 10 CRAS",
                            TRUE~as.character(n_cras))) %>%
  mutate(grupo = factor(grupo, levels = c("Nenhum CRAS",
                                            "1 CRAS",
                                            "De 2 a 3 CRAS",
                                            "De 4 a 6 CRAS",
                                            "De 7 a 10 CRAS",
                                            "Mais de 10 CRAS"))) %>%
  group_by(Porte, grupo) %>%
  summarise(n=n()) #%>%
#  complete(grupo, fill = list(n=0))

niveis_porte <- dados$Porte %>%
  levels() %>%
  append("Brasil")

grafico <- dados %>%
  spread(Porte, n, fill = 0) %>%
  mutate("Brasil" = rowSums(.[2:6])) %>%
  gather("Porte","n",-grupo) %>%
  mutate(Porte = factor(Porte, levels = niveis_porte)) %>%
  group_by(Porte) %>%
  mutate("Percentual" = n/sum(n)) %>%

  f_grafico_col_stack_percent(Porte, Percentual, grupo, 2)

grafico
```





No que se refere ao imóvel de funcionamento do CRAS, é possível notar no @fig-CRAS-imovel, que no período entre 2008 e 2022 o movimento foi de:

Aumento das unidades que funcionam em imóvel próprio. No primeiro ano da série histórica, o percentual era de 44% chegando a 60% em 2022;

Decréscimo das unidades com funcionamento em imóveis alugados, passando de 48% para 31%; e

Aumento das unidades funcionando em imóveis cedidos, evoluindo de 6,9% para 10%, o maior valor da série histórica.[^unidades-3]

[^unidades-3]: Para os anos de 2018 e 2019 esse dado não foi coletado no Censo SUAS


```{r fig-CRAS-imovel, fig.cap = "Evolução dos CRAS segundo situação do imóvel – Brasil, 2007 a 2023", fig.footer = "Fonte: MDS, Censo SUAS."}

grafico <- f_equip_imovel(cras_2008, `situacao_imovel`, "2008") %>%
  #bind_rows(f_equip_imovel(cras_2007, v15, "2007")) %>%
  bind_rows(f_equip_imovel(cras_2009, `q5_situac_imovel`, "2009")) %>%
  bind_rows(f_equip_imovel(cras_2010, q5, "2010")) %>%
  bind_rows(f_equip_imovel(cras_2011, q5, "2011")) %>%
  bind_rows(f_equip_imovel(cras_2012, q5, "2012")) %>%
  bind_rows(f_equip_imovel(cras_2013, q5, "2013")) %>%
  bind_rows(f_equip_imovel(cras_2014, q4, "2014")) %>%
  bind_rows(f_equip_imovel(cras_2015, q4, "2015")) %>%
  bind_rows(f_equip_imovel(cras_2016, q4, "2016")) %>%
  bind_rows(f_equip_imovel(cras_2017, q4, "2017")) %>%
  #bind_rows(f_equip_imovel(cras_2018, q4, "2018")) %>%
  #bind_rows(f_equip_imovel(cras_2019, q4, "2019")) %>%
  bind_rows(f_equip_imovel(cras_2020, q3, "2020")) %>%
  bind_rows(f_equip_imovel(cras_2021, q3, "2021")) %>%
  bind_rows(f_equip_imovel(cras_2022, q3, "2022")) %>%
  bind_rows(f_equip_imovel(cras_2023, q4, "2023")) %>%
  

  #2018 não fazem essa pergunta
  #2019 não fazem essa pergunta
  #2020

  f_grafico_col_stack_percent(Categoria, Percentual, Nível, 1)

grafico
```


No tocante a acessibilidade nas unidades de CRAS, observa-se no @fig-CRAS-acessibilidade um avanço em todas as condições de acessibilidade nas unidades de CRAS.[^unidades-4] Apesar da evolução, os dados ainda apontam para desafios, sobretudo no que se refere a banheiro adaptado que possui o percentual mais baixo de unidades com essa acessibilidade.

[^unidades-4]: foram considerados acesso adaptado, os imóveis que informam possuir acessibilidade, de acordo com a norma ABNT ou não

```{r fig-CRAS-acessibilidade, fig.cap = "Evolução percentual de CRAS com condições de acessibilidade - Brasil; 2013, 2018 e 2023", fig.footer = "Fonte: MDS, Censo SUAS."}

#tabela <- equip_acessibilidade(cras_2010, q10_1, "2010", "1") %>%
#  bind_rows(equip_acessibilidade(cras_2010, q10_2, "2010", "2")) %>%
#  bind_rows(equip_acessibilidade(cras_2010, q10_3, "2010", "3")) %>%
#  bind_rows(equip_acessibilidade(cras_2010, q10_4, "2010", "4")) %>%
#  bind_rows(equip_acessibilidade(cras_2011, q10a, "2011", "1")) %>%
#  bind_rows(equip_acessibilidade(cras_2011, q10b, "2011", "2")) %>%
#  bind_rows(equip_acessibilidade(cras_2011, q10c, "2011", "3")) %>%
#  bind_rows(equip_acessibilidade(cras_2011, q10d, "2011", "4")) %>%
#tabela <- equip_acessibilidade(cras_2012, q10a, "2012", "1") %>%
#  bind_rows(equip_acessibilidade(cras_2012, q10b, "2012", "2")) %>%
#  bind_rows(equip_acessibilidade(cras_2012, q10c, "2012", "3")) %>%
#  bind_rows(equip_acessibilidade(cras_2012, q10d, "2012", "4")) %>%
tabela <- (equip_acessibilidade(cras_2013, q10a, "2013", "1")) %>%
  bind_rows(equip_acessibilidade(cras_2013, q10b, "2013", "2")) %>%
  bind_rows(equip_acessibilidade(cras_2013, q10c, "2013", "3")) %>%
  bind_rows(equip_acessibilidade(cras_2013, q10d, "2013", "4")) %>%
#  bind_rows(equip_acessibilidade(cras_2014, q9a, "2014", "1")) %>%
#  bind_rows(equip_acessibilidade(cras_2014, q9b, "2014", "2")) %>%
#  bind_rows(equip_acessibilidade(cras_2014, q9c, "2014", "3")) %>%
#  bind_rows(equip_acessibilidade(cras_2014, q9d, "2014", "4")) %>%
#  bind_rows(equip_acessibilidade(cras_2015, q9_1, "2015", "1")) %>%
#  bind_rows(equip_acessibilidade(cras_2015, q9_2, "2015", "2")) %>%
#  bind_rows(equip_acessibilidade(cras_2015, q9_3, "2015", "3")) %>%
#  bind_rows(equip_acessibilidade(cras_2015, q9_4, "2015", "4")) %>%
#  bind_rows(equip_acessibilidade(cras_2016, q9_1, "2016", "1")) %>%
#  bind_rows(equip_acessibilidade(cras_2016, q9_2, "2016", "2")) %>%
#  bind_rows(equip_acessibilidade(cras_2016, q9_3, "2016", "3")) %>%
#  bind_rows(equip_acessibilidade(cras_2016, q9_4, "2016", "4")) %>%
#  bind_rows(equip_acessibilidade(cras_2017, q9.1, "2017", "1")) %>%
#  bind_rows(equip_acessibilidade(cras_2017, q9.2, "2017", "2")) %>%
#  bind_rows(equip_acessibilidade(cras_2017, q9.3, "2017", "3")) %>%
#  bind_rows(equip_acessibilidade(cras_2017, q9.4, "2017", "4")) %>%
  bind_rows(equip_acessibilidade(cras_2018, q_8_1, "2018", "1")) %>%
  bind_rows(equip_acessibilidade(cras_2018, q_8_2, "2018", "2")) %>%
  bind_rows(equip_acessibilidade(cras_2018, q_8_3, "2018", "3")) %>%
  bind_rows(equip_acessibilidade(cras_2018, q_8_4, "2018", "4")) %>%
#  bind_rows(equip_acessibilidade(cras_2022, q8_1, "2022", "1")) %>%
#  bind_rows(equip_acessibilidade(cras_2022, q8_2, "2022", "2")) %>%
#  bind_rows(equip_acessibilidade(cras_2022, q8_3, "2022", "3")) %>%
#  bind_rows(equip_acessibilidade(cras_2022, q8_4, "2022", "4")) %>%
  bind_rows(equip_acessibilidade(cras_2023, q9_1, "2023", "1")) %>%
  bind_rows(equip_acessibilidade(cras_2023, q9_2, "2023", "2")) %>%
  bind_rows(equip_acessibilidade(cras_2023, q9_3, "2023", "3")) %>%
  bind_rows(equip_acessibilidade(cras_2023, q9_4, "2023", "4")) %>%
  ungroup() %>%
  mutate(Categoria=str_wrap(Categoria,width=34))

ordenado<-tabela %>%
  filter(Ano == "2023") %>%
  arrange(Percentual) %>%
  pull(Categoria)

grafico<-tabela %>%
  mutate(Categoria = factor(Categoria, levels = ordenado)) %>%
  f_grafico_col_percent_flip(Categoria, Percentual, Ano, 1)

grafico
```


Relacionando as condições de acessibilidade com a situação do imóvel através do @fig-CRAS-acessibilidade-situacao, verificou-se, em 2022, que as condições de acessibilidade em CRAS localizados em imóveis próprios possuem números significativamente elevados em relação aos imóveis alugados ou cedidos.

```{r fig-CRAS-acessibilidade-situacao, fig.cap = "Percentual de CRAS com condições de acessibilidade por situação do imóvel – Brasil, 2023", fig.footer = "Fonte: MDS, Censo SUAS."}

#tabela <- equip_acessibilidade_situacao(cras_2016, q4, q9_1, "1") %>%
#  bind_rows(equip_acessibilidade_situacao(cras_2016, q4, q9_2, "2")) %>%
#  bind_rows(equip_acessibilidade_situacao(cras_2016, q4, q9_3, "3")) %>%
#  bind_rows(equip_acessibilidade_situacao(cras_2016, q4, q9_4, "4")) %>%
#tabela <- equip_acessibilidade_situacao(cras_2017, q4, q9.1, "1") %>%
#  bind_rows(equip_acessibilidade_situacao(cras_2017, q4, q9.2, "2")) %>%
#  bind_rows(equip_acessibilidade_situacao(cras_2017, q4, q9.3, "3")) %>%
#  bind_rows(equip_acessibilidade_situacao(cras_2017, q4, q9.4, "4")) %>%
#tabela <- equip_acessibilidade_situacao(cras_2022, q3, q8_1, "1") %>%
#  bind_rows(equip_acessibilidade_situacao(cras_2022, q3, q8_2, "2")) %>%
#  bind_rows(equip_acessibilidade_situacao(cras_2022, q3, q8_3, "3")) %>%
#  bind_rows(equip_acessibilidade_situacao(cras_2022, q3, q8_4, "4"))
tabela <- equip_acessibilidade_situacao(cras_2023, q4, q9_1, "1") %>%
  bind_rows(equip_acessibilidade_situacao(cras_2023, q4, q9_2, "2")) %>%
  bind_rows(equip_acessibilidade_situacao(cras_2023, q4, q9_3, "3")) %>%
  bind_rows(equip_acessibilidade_situacao(cras_2023, q4, q9_4, "4"))

ordenado<-tabela %>%
  filter(Situacao == "Próprio") %>%
  arrange(Percentual) %>%
  pull(Categoria)

grafico<-tabela %>%
  mutate(Categoria = factor(Categoria, levels = rev(ordenado))) %>%
  f_grafico_col_group_percent(Situacao, Percentual, Categoria, 4)

grafico
```


Em relação a conectividade, em especial o acesso à internet, o percentual de CRAS com acesso à internet aumentou significativamente desde 2007, chegando no último ano desta série com mais de 99% das unidades com computadores com acesso à internet, conforme o @fig-CRAS-internet-percentual.

```{r fig-CRAS-internet, fig.cap = "Distribuição dos CRAS com computadores com acesso à internet; 2007, 2012, 2017 e 2022", fig.footer = "Fonte: MDS, Censo SUAS.", eval = FALSE}

f_cras_internet = function(df, q, ano){
  q <- enquo(q)
  ano <- quo_name(ano)

  df %>%
    select(!! q) %>%
    group_by(!! q) %>%
    summarise(Total=n()) %>%
    mutate("Ano" = !! ano, Percentual = Total/sum(Total)*100) %>%
    filter(!! q == 1)
}

grafico <- f_cras_internet(cras_2007, `Acesso a Internet`, "2007") %>%
  bind_rows(f_cras_internet(cras_2012, q13b, "2012")) %>%
  bind_rows(f_cras_internet(cras_2017, q12.2, "2017")) %>%
  bind_rows(f_cras_internet(cras_2022, q11_2, "2022")) %>%

  ggplot(aes(x = Ano)) +
#  geom_col(aes(fill = Percentual)) +
  geom_col(aes(y = Percentual*24)) +
  geom_line(aes(y = Total)) +
  geom_point(aes(y = Total)) +
  geom_text(aes(label = percent(Percentual/100), y=(Percentual+1.5)*24)) +
  geom_text(aes(label = Total, y=Total+50)) +
  scale_y_continuous(expand = expansion(mult = c(0, .1)), sec.axis = sec_axis(~./24, name = "%")) +
  labs(y = "Total") +
  theme(legend.position="bottom",
        legend.title = element_blank(),
        axis.title.x = element_blank(),
        axis.ticks.x = element_blank(),
        axis.line.x = element_line(),
        axis.line.y = element_line(),
        panel.background = element_blank()) +
  guides(fill=guide_legend(nrow=1,byrow=TRUE))

grafico
```

```{r fig-CRAS-internet-quantitativo, fig.cap = "Evolução do quantitativo de CRAS com computadores com acesso à internet – Brasil, 2007 a 2017", fig.footer = "Fonte: MDS, Censo SUAS.", eval=FALSE}

#grafico <- f_selecao_regiao_ano(cras_2007, v17, "1", Gran_reg, "2007")
#  bind_rows(f_quantitativo_regiao_ano(cras_2008, Região, "2008")) %>%
#  bind_rows(f_quantitativo_regiao_ano(cras_2009, Região, "2009")) %>%
#  bind_rows(f_quantitativo_regiao_ano(cras_2010, Região, "2010")) %>%
#  bind_rows(f_quantitativo_regiao_ano(cras_2011, IBGE, "2011")) %>%
#  bind_rows(f_quantitativo_regiao_ano(cras_2012, Região, "2012")) %>%
#  bind_rows(f_quantitativo_regiao_ano(cras_2013, Região, "2013")) %>%
#  bind_rows(f_quantitativo_regiao_ano(cras_2014, Região, "2014")) %>%
#  bind_rows(f_quantitativo_regiao_ano(cras_2015, Região, "2015")) %>%
#  bind_rows(f_quantitativo_regiao_ano(cras_2016, Região, "2016")) %>%
#  bind_rows(f_quantitativo_regiao_ano(cras_2017, Região, "2017")) %>%
#  ggplot(aes(x = Região, y = n, group = Ano)) +
#  geom_col(aes(fill = Ano), position="dodge") +
#  geom_text(aes(label = format(n, big.mark="."), y=n+300), position = position_dodge(width = 0.9), angle = 90, size = 2.5) #+
#  scale_y_continuous(expand = expansion(mult = c(0, .1))) +
#  theme(legend.position="bottom",
#        legend.title = element_blank(),
#        axis.title = element_blank(),
#        axis.ticks = element_blank(),
#        axis.text.y = element_blank(),
#        axis.line.x = element_line(),
#        panel.background = element_blank()) +
#  guides(fill=guide_legend(nrow=1,byrow=TRUE))

grafico
```


```{r fig-CRAS-internet-percentual, fig.cap = "Evolução percentual de CRAS com computadores com acesso à internet – Brasil; 2007, 2012, 2017 e 2022", fig.footer = "Fonte: MDS, Censo SUAS.",}

grafico <-

 # f_maior0_regiao_ano(cras_2007, `Acesso a Internet`, ibge, "2007") %>%
 # bind_rows(cras_2012, q13b, Região, "2012")) %>%
   f_maior0_regiao_ano(cras_2013, q12_2, Região, "2013") %>%
 # bind_rows(f_maior0_regiao_ano(cras_2017, q12.2, Região, "2017")) %>%
   bind_rows(f_maior0_regiao_ano(cras_2018, q_11_2, Regiao, "2018")) %>%
 # bind_rows(f_maior0_regiao_ano(cras_2022, q11_2, IBGE, "2022")) %>%
   bind_rows(f_maior0_regiao_ano(cras_2023, q11_2, IBGE, "2023")) %>%
  
  f_grafico_col_group_percent(Região, Percentual, Ano, 1)

grafico
```




Em relação aos CRAS com locais para Cadastro Único, o dado abaixo tráz o percentual destas informações e a disposição de equipes para esta finalidade. Nota-se o aumento ao longo dos anos, das unidades de CRAS que possuem Cadastro Único com equipe exclusiva, chegando no Censo SUAS de 2022 com 59% (@fig-equip-cadunico-cras).

```{r fig-equip-cadunico-cras, fig.cap = "Percentual de CRAS com locais para CadÚnico - 2017 - 2023", fig.footer = "Fonte: MDS, Censo SUAS"}

equip_cadunico  = function(df, q, ano){
  q <- enquo(q)
  ano <- quo_name(ano)

  df %>%
    select(!! ano := !! q) %>%
    gather("Categoria","Nível") %>%
    mutate(Nível = case_when(Nível == "Sim, com equipe exclusiva para esta finalidade"~"Sim, com equipe exclusiva para esta finalidade",
                             Nível == "Não realiza"~"Não",
                              TRUE ~ Nível))%>%
    filter(!is.na(Nível)) %>%
    mutate(Nível = factor(Nível, levels = c("Sim, com equipe exclusiva para esta finalidade",
                                            "Sim, com outra equipe",
                                            "Sim, com a equipe responsável pelo PAIF",
                                            "Não"))) %>%
    group_by(Categoria, Nível) %>%
    summarise(n=n()) %>%
    group_by(Categoria) %>%
    mutate(Percentual = n/sum(n), Posição = (cumsum(n/sum(n)) - 0.5 * n/sum(n)))
}

grafico <- equip_cadunico(cras_2010, q43, "2010") %>%
   bind_rows(equip_cadunico(cras_2011, q47, "2011"))%>%
   bind_rows(equip_cadunico(cras_2012, q45, "2012"))%>%
   bind_rows(equip_cadunico(cras_2013, q40, "2013"))%>%
   bind_rows(equip_cadunico(cras_2014, q41, "2014"))%>%
   bind_rows(equip_cadunico(cras_2015, q37, "2015"))%>%
   bind_rows(equip_cadunico(cras_2016, q31, "2016")) %>%
   bind_rows(equip_cadunico(cras_2017, q35, "2017")) %>%
   bind_rows(equip_cadunico(cras_2018, q_40, "2018")) %>%
   bind_rows(equip_cadunico(cras_2019, q39, "2019")) %>%
   bind_rows(equip_cadunico(cras_2020, q39, "2020")) %>%
   bind_rows(equip_cadunico(cras_2021, q39, "2021")) %>%
   bind_rows(equip_cadunico(cras_2022, q39, "2022")) %>%
   bind_rows(equip_cadunico(cras_2023, q35, "2023")) %>%

 #CRAS2020_base com códigos numericos

  f_grafico_col_stack_percent(Categoria, Percentual, Nível, 2)

grafico
```


## Centros de Convivência

Os Centros de Convivência, são unidades que executam o Serviço de Convivência e Fortalecimento de Vínculos (SCFV) e compõem a Rede de Proteção Social Básica. Desde 2014 o número de Centros de Convivência no Brasil vem aumentando, passando de 7.882 unidades em 2014 para 8.454 em 2016, acréscimo de 572 unidades. A Região Norte tem a menor quantidade de unidades (238 ou 2,8% do total), seguida do Centro-Oeste com 568 Unidades (ou 6,7% do total). A região Sudeste tem o maior número de Centros de Convivência, com 4.035 Unidades (47,7% do total).


```{r fig-quantitativo-CentroConv, fig.cap = "Evolução do quantitativo de Centro de Convivência, segundo grandes regiões; 2014, 2016, 2018, 2020, 2022 e 2023", fig.footer = "Fonte: MDS, Censo SUAS"}

grafico <-
  f_quantitativo_regiao_ano(ceconv_2014, Região, "2014") %>%
   # bind_rows(f_quantitativo_regiao_ano(ceconv_2015, IBGE, "2015")) %>%
   bind_rows(f_quantitativo_regiao_ano(ceconv_2016, IBGE, "2016")) %>%
   # bind_rows(f_quantitativo_regiao_ano(ceconv_2017, IBGE, "2017")) %>%
   bind_rows(f_quantitativo_regiao_ano(ceconv_2018, IBGE, "2018")) %>%
   # bind_rows(f_quantitativo_regiao_ano(ceconv_2018, IBGE, "2019")) %>%
    bind_rows(f_quantitativo_regiao_ano(ceconv_2020, IBGE, "2020")) %>%
   # bind_rows(f_quantitativo_regiao_ano(ceconv_2021, IBGE, "2021")) %>%
   bind_rows(f_quantitativo_regiao_ano(ceconv_2022, IBGE, "2022")) %>%
   bind_rows(f_quantitativo_regiao_ano(ceconv_2023, IBGE, "2023")) %>%
   f_grafico_col_group_numero(Região, n, Ano, 1)

grafico
```


Os Centros de Convivência podem ser unidades públicas ou vinculadas a entidades de assistência social inscritas nos Conselhos de Assistência Social do município ou do Distrito Federal. Em 2022, 44% dos Centros de Convivência eram governamentais e 56% das unidades eram não governamentais. [^unidades-5]

[^unidades-5]: os dados de 2016 não foi possível de ser coletato devido a dificuldades de leitura da base de dados



```{r fig-centro-conv-natureza, fig.cap = "Quantitativo de Centros de Convivência por Natureza da Unidade - BRASIL; 2016 a 2023", fig.footer = "Fonte: MDS, Censo SUAS."}



centro  = function(df, q, ano){
  q <- enquo(q)
  ano <- quo_name(ano)

  df %>%
    select(!! ano := !! q) %>%
    gather("Categoria","Nível") %>%
    mutate(Nível = case_when(Nível == "Não Governamental"|
                             Nível == "Organização da Sociedade Civil" ~"Não Governamental/Organização da Sociedade Civil",
                             TRUE ~ Nível)) %>%
    filter(!is.na(Nível)) %>%
    mutate(Nível = factor(Nível, levels = c("Governamental",
                                            "Não Governamental/Organização da Sociedade Civil"))) %>%
    group_by(Categoria, Nível) %>%
    summarise(n=n()) %>%
    group_by(Categoria) %>%
    mutate(Percentual = n/sum(n))
}

grafico <-
  centro(ceconv_2016, q2, "2016") %>%
    bind_rows(centro(ceconv_2017, q2, "2017")) %>%
    bind_rows(centro(ceconv_2018, q_2, "2018")) %>%
    #bind_rows(centro(ceconv_2019, q2, "2019")) %>%
    bind_rows(centro(ceconv_2020, q27, "2020")) %>%
    bind_rows(centro(ceconv_2021, q27, "2021")) %>%
    bind_rows(centro(ceconv_2022, q27, "2022")) %>%
    bind_rows(centro(ceconv_2023, q3, "2023")) %>%

  #2019 - dado numerico

  f_grafico_col_stack_percent(Categoria, Percentual, Nível, 1)

grafico
```


## Centro de Referência Especializada de Assistência Social (CREAS)

Os Centros de Referência Especializados de Assistência Social (CREAS) são unidades públicas estatais que ofertam serviços da Proteção Social Especial à pessoas e famílias em situação de risco pessoal ou social e/ou em situação de violação de direitos.

O Censo SUAS 2022 registrou 2.846 CREAS no país: um incremento de 679 novas unidades em relação aos últimos 10 anos. O @fig-creas-quantitativo sinaliza essa evolução por Regiões do país.


```{r fig-creas-quantitativo, fig.cap = "Evolução do quantitativo de CREAS, segundo grandes regiões - Brasil; 2013, 2018 e 2023", fig.footer = "Fonte: MDS, Censo SUAS."}

  grafico <-
  #f_quantitativo_regiao_ano(creas_2012, IBGE, "2012") %>%
  f_quantitativo_regiao_ano(creas_2013, IBGE, "2013") %>%
  #bind_rows(f_quantitativo_regiao_ano(creas_2014, IBGE, "2014")) %>%
  #bind_rows(f_quantitativo_regiao_ano(creas_2015, IBGE, "2015")) %>%
  #bind_rows(f_quantitativo_regiao_ano(creas_2016, IBGE7, "2016")) %>%
  #bind_rows(f_quantitativo_regiao_ano(creas_2017, IBGE, "2017")) %>%
  bind_rows(f_quantitativo_regiao_ano(creas_2018, IBGE, "2018")) %>%
  #bind_rows(f_quantitativo_regiao_ano(creas_2019, IBGE, "2019")) %>%
  #bind_rows(f_quantitativo_regiao_ano(creas_2020, IBGE, "2020")) %>%
  #bind_rows(f_quantitativo_regiao_ano(creas_2021, IBGE, "2021")) %>%
  #bind_rows(f_quantitativo_regiao_ano(creas_2022, IBGE, "2022")) %>%
  bind_rows(f_quantitativo_regiao_ano(creas_2023, IBGE, "2023")) %>%
  f_grafico_col_group_numero(Região, n, Ano, 1)

grafico
```


De acordo com o porte populacional, o @fig-CREAS-porte mostra o número de unidades de CREAS por município. É possível notar que os de Pequeno Porte I e II possuem, respectivamente, 77% e 5,3% de municípios com nenhum CREAS. Em nível nacional este valor é de 54%.

```{r fig-CREAS-porte, fig.cap = "Percentual de municípios por número de CREAS, segundo porte populacional, excluídos os CREAS regionais - Brasil, 2023", fig.footer = "Fonte: MDS, Censo SUAS; e IBGE, estimativas da população residente para os municípios"}

creas_municipios <- creas_2023 %>%
  select(IBGE) %>%
  group_by(IBGE) %>%
  summarise(n_creas=n())

populacao <- pop_municipios_2017 %>%
  mutate(`COD. MUNIC` = str_sub(`COD. MUNIC`, end = 4)) %>%
  mutate(IBGE = as.numeric(paste0(`COD. UF`, `COD. MUNIC`))) %>%
  select(IBGE, `POPULAÇÃO ESTIMADA`)

dados <- creas_municipios %>%
  full_join(populacao, by = c("IBGE" = "IBGE")) %>%
  mutate(grupo = case_when(is.na(n_creas)~"Nenhum CREAS",
                            n_creas == 0~"Nenhum CREAS",
                            n_creas == 1~"1 CREAS",
                            n_creas <= 3~"De 2 a 3 CREAS",
                            n_creas <= 6~"De 4 a 6 CREAS",
                            n_creas <= 10~"De 7 a 10 CREAS",
                            n_creas > 10~"Mais de 10 CREAS",
                            TRUE~as.character(n_creas))) %>%
  mutate(grupo = factor(grupo, levels = c("Nenhum CREAS",
                                            "1 CREAS",
                                            "De 2 a 3 CREAS",
                                            "De 4 a 6 CREAS",
                                            "De 7 a 10 CREAS",
                                            "Mais de 10 CREAS"))) %>%
  filter(!is.na(`POPULAÇÃO ESTIMADA`)) %>%
  f_porte_populacional(`POPULAÇÃO ESTIMADA`) %>%
  group_by(Porte, grupo) %>%
  summarise(n=n()) #%>%
#  complete(grupo, fill = list(n=0))

niveis_porte <- dados$Porte %>%
  levels() %>%
  append("Brasil")

grafico <- dados %>%
  spread(Porte, n, fill = 0) %>%
  mutate("Brasil" = rowSums(.[2:6])) %>%
  gather("Porte","n",-grupo) %>%
  mutate(Porte = factor(Porte, levels = niveis_porte)) %>%
  group_by(Porte) %>%
  mutate("Percentual" = n/sum(n)) %>%

  f_grafico_col_stack_percent(Porte, Percentual, grupo, 2)

grafico
```


Ao observar a série histórica do @fig-creas-situacao sobre o funcionamento dos CREAS, que pode ser em imóvel próprio, alugado ou cedido. É possível notar um aumento de 10 pontos percentuais, entre os anos de 2012 e 2022, em unidades com funcionamento em imóveis próprios. Em contrapartida, há um decréscimo, também de 10% de unidades em imóveis alugados. Quanto às unidades em funcionamento em imóveis cedidos, percebe-se um leve aumento ao longo dos anos[^unidades-6].

[^unidades-6]: Para os anos de 2018 e 2019 esse dado não foi computado no Censo SUAS


```{r fig-creas-situacao, fig.cap = "Evolução dos CREAS segundo situação do imóvel – Brasil; 2012 a 2023",fig.footer = "Fonte: MDS, Censo SUAS."}

#grafico <- f_equip_imovel(creas_2012, q5, "2012") %>%
  #bind_rows(f_equip_imovel(creas_2008, situacao_imovel, "2008")) %>%
  #bind_rows(f_equip_imovel(creas_2009, q5_situac_imovel, "2009")) %>%
  #bind_rows(f_equip_imovel(creas_2010, q5, "2010")) %>%
  #bind_rows(f_equip_imovel(creas_2011, q5, "2011")) %>%
grafico <- f_equip_imovel(creas_2012, q5, "2012") %>%
  #bind_rows(f_equip_imovel(creas_2013, q5, "2013")) %>%
  bind_rows(f_equip_imovel(creas_2014, q4, "2014")) %>%
  bind_rows(f_equip_imovel(creas_2015, q4, "2015")) %>%
  bind_rows(f_equip_imovel(creas_2016, q4, "2016")) %>%
  bind_rows(f_equip_imovel(creas_2017, q4, "2017")) %>%
  #bind_rows(f_equip_imovel(creas_2018, q3, "2018")) %>%
  #bind_rows(f_equip_imovel(creas_2019, q4, "2019")) %>%
  bind_rows(f_equip_imovel(creas_2020, q3, "2020")) %>%
  bind_rows(f_equip_imovel(creas_2021, q3, "2021")) %>%
  bind_rows(f_equip_imovel(creas_2022, q3, "2022")) %>%
  bind_rows(f_equip_imovel(creas_2023, q3, "2023")) %>%


  # não há essa pergunta: 2018,2019

  f_grafico_col_stack_percent(Categoria, Percentual, Nível, 1)

grafico
```


De acordo com os dados do Censo SUAS do período de 2012 a 2022, houve aumento das condições de acessibilidade em vários itens dos CREAS. O @fig-creas-acessibilidade sinaliza que a presença do acesso principal adaptado com rota ascessível aos espaços (recepção, salas de atendimento e espaços de uso coletivo) é a mais presente nas unidades de CREAS, com destaque para 83% no CENSO SUAS de 2022.

O dado proporcional menos presente nas unidades de CREAS é o Banheiro adaptado. Em de 2012, 33% dos CREAS foram identificados com banheiro adaptado. Esse mesmo dado em 2022 chegou a 55% dos CREAS. Destaca-se um crescimento de 22 pontos percentuais em relação ao ano de 2012. [^unidades-7].

[^unidades-7]: foram considerados acesso adptado os imóveis que informam possuir acessibilidade, de acordo com a norma ABNT ou não


```{r fig-creas-acessibilidade, fig.cap = "Evolução percentual de CREAS com condições de acessibilidade - Brasil; 2012, 2018 e 2023", fig.footer = "Fonte: MDS, Censo SUAS."}

#(2013 com outros padrões)


  #tabela <- equip_acessibilidade(creas_2010, q9_1, "2010", "1") %>%
#  bind_rows(equip_acessibilidade(creas_2010, q9_2, "2010", "2")) %>%
#  bind_rows(equip_acessibilidade(creas_2010, q9_3, "2010", "3")) %>%
#  bind_rows(equip_acessibilidade(creas_2010, q9_4, "2010", "4")) %>%
  tabela <- equip_acessibilidade(creas_2012, q10a, "2012", "1") %>%
  bind_rows(equip_acessibilidade(creas_2012, q10b, "2012", "2")) %>%
  bind_rows(equip_acessibilidade(creas_2012, q10c, "2012", "3")) %>%
  bind_rows(equip_acessibilidade(creas_2012, q10d, "2012", "4")) %>%
#  bind_rows(equip_acessibilidade(creas_2013, q10a, "2013", "1") %>%
#  bind_rows(equip_acessibilidade(creas_2013, q10b, "2013", "2")) %>%
#  bind_rows(equip_acessibilidade(creas_2013, q10c, "2013", "3")) %>%
#  bind_rows(equip_acessibilidade(creas_2013, q10d, "2013", "4")) %>%
#  bind_rows(equip_acessibilidade(creas_2017, q9.1, "2017", "1")) %>%
#  bind_rows(equip_acessibilidade(creas_2017, q9.2, "2017", "2")) %>%
#  bind_rows(equip_acessibilidade(creas_2017, q9.3, "2017", "3")) %>%
#  bind_rows(equip_acessibilidade(creas_2017, q9.4, "2017", "4")) %>%
  bind_rows(equip_acessibilidade(creas_2018, q7_1, "2018", "1")) %>%
  bind_rows(equip_acessibilidade(creas_2018, q7_2, "2018", "2")) %>%
  bind_rows(equip_acessibilidade(creas_2018, q7_3, "2018", "3")) %>%
  bind_rows(equip_acessibilidade(creas_2018, q7_4, "2018", "4")) %>%
#  bind_rows(equip_acessibilidade(creas_2022, q9_1, "2022", "1")) %>%
#  bind_rows(equip_acessibilidade(creas_2022, q9_2, "2022", "2")) %>%
#  bind_rows(equip_acessibilidade(creas_2022, q9_3, "2022", "3")) %>%
#  bind_rows(equip_acessibilidade(creas_2022, q9_4, "2022", "4")) %>%
  bind_rows(equip_acessibilidade(creas_2023, q8_1, "2023", "1")) %>%
  bind_rows(equip_acessibilidade(creas_2023, q8_2, "2023", "2")) %>%
  bind_rows(equip_acessibilidade(creas_2023, q8_3, "2023", "3")) %>%
  bind_rows(equip_acessibilidade(creas_2023, q8_4, "2023", "4")) %>%
  ungroup() %>%
  mutate(Categoria=str_wrap(Categoria,width=34))

ordenado<-tabela %>%
  filter(Ano == 2023) %>%
  arrange(Percentual) %>%
  pull(Categoria)

grafico<-tabela %>%
  mutate(Categoria = factor(Categoria, levels = ordenado)) %>%
  f_grafico_col_percent_flip(Categoria, Percentual, Ano, 1)

grafico
```


O @fig-CREAS-acessibilidade-situacao mostra a presença de condições de acessibilidade segundo a situação do imóvel. Os dados sinalizam que a acessibilidade é significativamente mais presente em imovéis próprios.


```{r fig-CREAS-acessibilidade-situacao, fig.cap = "Evolução percentual de CREAS com condições de acessibilidade por situação do imóvel – Brasil, 2023", fig.footer = "Fonte: MDS, Censo SUAS."}

tabela <- 
  equip_acessibilidade_situacao(creas_2023, q3, q8_1, "1") %>%
  bind_rows(equip_acessibilidade_situacao(creas_2023, q3, q8_2, "2")) %>%
  bind_rows(equip_acessibilidade_situacao(creas_2023, q3, q8_3, "3")) %>%
  bind_rows(equip_acessibilidade_situacao(creas_2023, q3, q8_4, "4"))

ordenado<-tabela %>%
  filter(Situacao == "Próprio") %>%
  arrange(Percentual) %>%
  pull(Categoria)

grafico<-tabela %>%
  mutate(Categoria = factor(Categoria, levels = rev(ordenado))) %>%
  f_grafico_col_group_percent(Situacao, Percentual, Categoria, 4)

grafico
```


A existência de computadores com acesso à internet é um importante aspecto a ser observado quando se avalia a infraestrutura dos CREAS. No período de 2012 a 2022, observa-se que este item avançou de 89% para 99% dos CREAS que possuem computadores com acesso à internet conforme o @fig-CREAS-internet-percentual.

Esses números avançaram em todas as regiões, em especial, na Região Norte conforme pode ser observado no @fig-CREAS-internet-percentual.

```{r fig-CREAS-internet-percentual, fig.cap = "Evolução percentual de CREAS com computadores com acesso à internet – Brasil, 2013 - 2023", fig.footer = "Fonte: MDS, Censo SUAS."}



grafico <- 
  #grafico <- f_maior0_regiao_ano(creas_2012, q14, Região, "2012") %>%
  f_maior0_regiao_ano(creas_2013, q13, Região, "2013") %>%
  #bind_rows(f_maior0_regiao_ano(creas_2017, q13, IBGE, "2017")) %>%
  bind_rows(f_maior0_regiao_ano(creas_2018, q10_2, IBGE, "2018")) %>%
  #bind_rows(f_maior0_regiao_ano(creas_2022, q12_2, IBGE, "2022")) %>%
  bind_rows(f_maior0_regiao_ano(creas_2023, q10_2, IBGE, "2023")) %>%

  f_grafico_col_group_percent(Região, Percentual, Ano, 1)

grafico
```


```{r fig-creas-qtd_munic, fig.cap = "Evolução do quantitativo de CREAS; Brasil e grandes regiões; 2012, 2017 e 2022", fig.footer = "Fonte: MDS, Censo SUAS.", eval=FALSE}

#grafico <- f_percentual_municipios_regiao_ano(creas_2007, ibge, "2007") %>%
 #bind_rows(f_percentual_municipios_regiao_ano(creas_2008, IBGE, "2008")) %>%
 # bind_rows(f_percentual_municipios_regiao_ano(creas_2009, IBGE, "2009")) %>%
 # bind_rows(f_percentual_municipios_regiao_ano(creas_2010, ibge, "2010")) %>%
 #bind_rows(f_percentual_municipios_regiao_ano(creas_2011, IBGE, "2011")) %>%
grafico <- f_percentual_municipios_regiao_ano(creas_2012, IBGE, "2012") %>%
  #bind_rows(f_percentual_municipios_regiao_ano(creas_2013, IBGE, "2013")) %>%
  #bind_rows(f_percentual_municipios_regiao_ano(creas_2014, IBGE, "2014")) %>%
  #bind_rows(f_percentual_municipios_regiao_ano(creas_2015, IBGE, "2015")) %>%
  bind_rows(f_percentual_municipios_regiao_ano(creas_2016, IBGE7, "2016")) %>%
  bind_rows(f_percentual_municipios_regiao_ano(creas_2017, IBGE, "2017")) %>%
  bind_rows(f_percentual_municipios_regiao_ano(creas_2018, IBGE, "2018")) %>%
  bind_rows(f_percentual_municipios_regiao_ano(creas_2019, IBGE, "2019")) %>%
  bind_rows(f_percentual_municipios_regiao_ano(creas_2020, IBGE, "2020")) %>%
  bind_rows(f_percentual_municipios_regiao_ano(creas_2021, IBGE, "2021")) %>%
  bind_rows(f_percentual_municipios_regiao_ano(creas_2022, IBGE, "2022")) %>%

  ggplot(aes(x = Região, y = Percentual, group = Ano)) +
  geom_col(aes(fill = Ano), position="dodge") +
  geom_text(aes(label = percent(Percentual), y=Percentual+0.04), position = position_dodge(width = 0.9), angle = 90, size = 2.5) +
  scale_y_continuous(expand = expansion(mult = c(0, .1))) +
  theme(legend.position="bottom",
        legend.title = element_blank(),
        axis.title = element_blank(),
        axis.ticks = element_blank(),
        axis.text.y = element_blank(),
        axis.line.x = element_line(),
        panel.background = element_blank()) +
  guides(fill=guide_legend(nrow=1,byrow=TRUE))

grafico
```



```{r fig-CREAS-quantidade-municipios, fig.cap = "Evolução do quantitativo de municípios com CREAS, Brasil e grandes regiões - 2012, 2017 e 2022", fig.footer = "Fonte: MDS, Censo SUAS", eval=FALSE}

grafico <- f_percentual_municipios_regiao_ano(creas_2012, IBGE, "2012") %>%
  bind_rows(f_percentual_municipios_regiao_ano(creas_2017, IBGE, "2017")) %>%
  bind_rows(f_percentual_municipios_regiao_ano(creas_2022, IBGE, "2022")) %>%
  f_grafico_col_group_numero(Região, n, Ano, 1)

grafico
```

A oferta regionalizada de CREAS é uma estratégia que objetiva garantir a universalização do acesso e integralidade do antendimento da proteção socioassistencia especializada. Ela está prevista através da Resolução CNAS 31/2013. Essa composição é organizada através dos entes estaduais. O @fig-creas-regionais sinaliza a evolução dessa oferta.

```{r fig-creas-regionais, fig.cap = "Evolução do quantitativo de CREAS Regionais, Brasil e grandes regiões - 2013, 2018 e 2023", fig.footer = "Fonte: MDS, Censo SUAS."}

#não possui creas regional 2023

grafico <-
  f_selecao_regiao_ano(creas_2013, q1, "Regional", Região, "2013") %>%
  bind_rows(f_selecao_regiao_ano(creas_2017, q2, "Regional", Região, "2017")) %>%
  bind_rows(f_selecao_regiao_ano(creas_2018, q1, "Regional", Região, "2018")) %>%
  bind_rows(f_selecao_regiao_ano(creas_2019, q1, "Regional", Regiao, "2019")) %>%
 # bind_rows(f_selecao_regiao_ano(creas_2020, q1, "Regional", Regiao, "2020")) %>%
  bind_rows(f_selecao_regiao_ano(creas_2021, q1, "Regional", Regiao, "2021")) %>%
  bind_rows(f_selecao_regiao_ano(creas_2022, q1, "Regional", Região, "2022")) %>%
   bind_rows(f_selecao_regiao_ano(creas_2023, q1, "Regional", Regiao, "2023")) %>%
  f_grafico_col_group_numero(Região, n, Ano, 1)

grafico
```


## Centro de Referência Especializado para População em Situação de Rua (Centro POP)

Os Centros de Referência Especializados para População em Situação de Rua (Centros POP) são unidades públicas que oferecem atendimento especializado para a população em situação de rua, no âmbito da proteção social especial de média complexidade.

No período de 2012 a 2022, houve um importante aumento de 105 para 237 unidades, respectivamente, de Centros POP em nível nacional. Entre as regiões, a que apresentou maior aumento, no mesmo período, foi a do Sudeste, passando de 50 para 114 unidades (@fig-quantitativo-CentroPop).


```{r fig-quantitativo-CentroPop, fig.cap = "Evolução do quantitativo de Centro Pop - Brasil, 2013, 2018 e 2023", fig.footer = "Fonte: MDS, Censo SUAS"}

grafico <-
  #f_quantitativo_regiao_ano(cpop_2012, Região, "2012") %>%
   #bind_rows(f_quantitativo_regiao_ano(cpop_2011, IBGE, "2011")) %>%)
   f_quantitativo_regiao_ano(cpop_2013, Região, "2013") %>%
   #bind_rows(f_quantitativo_regiao_ano(cpop_2014, IBGE, "2014")) %>%
   #bind_rows(f_quantitativo_regiao_ano(cpop_2015, IBGE, "2015")) %>%
   #bind_rows(f_quantitativo_regiao_ano(cpop_2016, IBGE, "2016")) %>%
   #bind_rows(f_quantitativo_regiao_ano(cpop_2017, Região, "2017")) %>%
   bind_rows(f_quantitativo_regiao_ano(cpop_2018, Região, "2018")) %>%
   #bind_rows(f_quantitativo_regiao_ano(cpop_2019, Região, "2019")) %>%
   #bind_rows(f_quantitativo_regiao_ano(cpop_2020, IBGE, "2020")) %>%
   #bind_rows(f_quantitativo_regiao_ano(cpop_2021, IBGE, "2021")) %>%
   #bind_rows(f_quantitativo_regiao_ano(cpop_2022, IBGE, "2022")) %>%
   bind_rows(f_quantitativo_regiao_ano(cpop_2023, IBGE, "2023")) %>%
  f_grafico_col_group_numero(Região, n, Ano, 1)

grafico
```


Quanto à localização, a maior concentração de Centros POP está nos municípios de grande porte e metrópoles. Nos municípios de grande porte, 59% possuem ao menos 1 unidade. Nas metrópoles, 59% possuem de 2 a 3 unidades, 18% de 4 a 6 e 24% possuem 1 unidade. Com menor percentual, destacam-se os municípios de porte médio, onde 5,9% das unidades possuem, ao menos, 1 Centro POP (@fig-cpop-porte).

```{r fig-cpop-porte, fig.cap = "Percentual de municípios por número de Centro POP, segundo porte populacional - Brasil, 2023", fig.footer = "Fonte: MDS, Censo SUAS; e IBGE, estimativas da população residente para os municípios"}

cpop_municipios <- cpop_2023 %>%
  select(IBGE7) %>%
  group_by(IBGE7) %>%
  summarise(n_centropop=n())

porte_municipios <- pop_municipios_2017 %>%
  f_porte_populacional(`POPULAÇÃO ESTIMADA`) %>%
  mutate(IBGE7 = as.numeric(paste0(`COD. UF`, `COD. MUNIC`))) %>%
  select(IBGE7, Porte)

dados <- cpop_municipios %>%
  full_join(porte_municipios, by = c("IBGE7" = "IBGE7")) %>%
  mutate(grupo = case_when(is.na(n_centropop)~"Nenhum Centro POP",
                            n_centropop == 0~"Nenhum Centro POP",
                            n_centropop == 1~"1 Centro POP",
                            n_centropop <= 3~"De 2 a 3 Centro POP",
                            n_centropop <= 6~"De 4 a 6 Centro POP",
                            n_centropop <= 10~"De 7 a 10 Centro POP",
                            n_centropop > 10~"Mais de 10 Centro POP",
                            TRUE~as.character(n_centropop))) %>%
  mutate(grupo = factor(grupo, levels = c("Nenhum Centro POP",
                                            "1 Centro POP",
                                            "De 2 a 3 Centro POP",
                                            "De 4 a 6 Centro POP",
                                            "De 7 a 10 Centro POP",
                                            "Mais de 10 Centro POP"))) %>%
  group_by(Porte, grupo) %>%
  summarise(n=n()) #%>%
#  complete(grupo, fill = list(n=0))

niveis_porte <- dados$Porte %>%
  levels() %>%
  append("Brasil")

grafico <- dados %>%
  spread(Porte, n, fill = 0) %>%
  mutate("Brasil" = rowSums(.[2:6])) %>%
  gather("Porte","n",-grupo) %>%
  mutate(Porte = factor(Porte, levels = niveis_porte)) %>%
  group_by(Porte) %>%
  mutate("Percentual" = n/sum(n)) %>%

  f_grafico_col_stack_percent(Porte, Percentual, grupo, 2)

grafico
```


Considerando a acessibilidade, nota-se que as unidades instaladas em imóveis próprios apresentam, no geral, adaptações superiores quando comparadas aos alugados. Nos, sobressaindo aos demais, o banheiro adaptado é o que apresenta maior percentual (@fig-cpop-acessibilidade-situacao).

```{r fig-cpop-acessibilidade-situacao, fig.cap = "Percentual de Centros POP com condições de acessibilidade segundo situação do imóvel – Brasil, 2023", fig.footer = "Fonte: MDS, Censo SUAS."}

tabela <- 
  equip_acessibilidade_situacao(cpop_2023, q1, q7_1, "1") %>%
  bind_rows(equip_acessibilidade_situacao(cpop_2023, q1, q7_2, "2")) %>%
  bind_rows(equip_acessibilidade_situacao(cpop_2023, q1, q7_3, "3")) %>%
  bind_rows(equip_acessibilidade_situacao(cpop_2023, q1, q7_4, "4"))

ordenado<-tabela %>%
  filter(Situacao == "Próprio") %>%
  arrange(Percentual) %>%
  pull(Categoria)

grafico<-tabela %>%
  mutate(Categoria = factor(Categoria, levels = rev(ordenado))) %>%
  f_grafico_col_group_percent(Situacao, Percentual, Categoria, 4)

grafico
```


No tocante a computador conectado à internet, o Censo SUAS 2022 mostra que 100% dos Centros POP do Centro-Oeste e do Sul estão conectados. Por outro lado, revelando-se um desafio, está a Região Norte com menor percentual (Gráfico 46) (@fig-cpop-internet-percentual).



```{r fig-cpop-internet-percentual, fig.cap = "Percentual de Computadores nos Centro Pop com acesso à internet, 2013 a 2023", fig.footer = "Fonte: MDS, Censo SUAS."}

grafico <- 
  #grafico <- f_maior0_regiao_ano(cpop_2012, q14_2, Região, "2012") %>%
  f_maior0_regiao_ano(cpop_2013, q13_2, Região, "2013") %>%
  #bind_rows(f_maior0_regiao_ano(cpop_2017, q11.2, IBGE, "2017")) %>%
  bind_rows(f_maior0_regiao_ano(cpop_2018, q9_2, IBGE, "2018")) %>%
  #bind_rows(f_maior0_regiao_ano(cpop_2022, q10_2, IBGE, "2022")) %>%
  bind_rows(f_maior0_regiao_ano(cpop_2023, q10, IBGE, "2023")) %>%

  f_grafico_col_group_percent(Região, Percentual, Ano, 1)

grafico
```


## Centro-Dia

Os Centros Dia são unidades públicas especializadas para atender pessoas com deficiência e suas famílias. Ela está inserida no âmbito da Proteção Social Especial de Média Complexidade. No ano de 2015 havia no Brasil, 1.345 unidades. Em 2022 esse número foi de 1.919, representando um crescimento de 42,67% destas unidades, conforme pode ser observada no @fig-quantitativo-Centrodia.

```{r fig-quantitativo-Centrodia, fig.cap = "Evolução do quantitativo de Centro-Dia, segundo grandes regiões; 2015 a 2023", fig.footer = "Fonte: MDS, Censo SUAS."}

grafico <- 
   f_quantitativo_regiao_ano(cedia_2015, Região, "2015") %>%
#   f_quantitativo_regiao_ano(cedia_2016, Região, "2016") %>%
   bind_rows(f_quantitativo_regiao_ano(cedia_2017, IBGE, "2017")) %>%
#   bind_rows(f_quantitativo_regiao_ano(cedia_2018, IBGE, "2018")) %>%
   bind_rows(f_quantitativo_regiao_ano(cedia_2019, IBGE, "2019")) %>%
#   bind_rows(f_quantitativo_regiao_ano(cedia_2020, IBGE, "2020")) %>%
   bind_rows(f_quantitativo_regiao_ano(cedia_2021, IBGE, "2021")) %>%
#   bind_rows(f_quantitativo_regiao_ano(cedia_2022, IBGE, "2022")) %>%
   bind_rows(f_quantitativo_regiao_ano(cedia_2023, IBGE, "2023")) %>%
  f_grafico_col_group_numero(Região, n, Ano, 1)

grafico
```


Em relação a natureza destas unidades, é possível notar que os Centros-Dia mantém-se majoritariamente, desde 2015, localizados em unidades das Organizações da Sociedade Civil (OSC) conforme o @fig-cdia-natureza.[^unidades-8]

[^unidades-8]: não foi identificado essa pergunta para o ano de 2017 e para o ano de 2022 não foi possível gerar a informação a partir do banco de dados disponível


```{r fig-cdia-natureza, fig.cap = "Quantitativo de Centros Dia por Natureza da Unidade - BRASIL, 2015 a 2023", fig.footer = "Fonte: MDS, Censo SUAS."}

centrodia  = function(df, q, ano){
  q <- enquo(q)
  ano <- quo_name(ano)

  df %>%
    select(!! ano := !! q) %>%
    gather("Categoria","Nível") %>%
    mutate(Nível = case_when(Nível == "Não Governamental"~"Não Governamental/Organização da Sociedade Civil",
                             Nível == "Não-Governamental"~"Não Governamental/Organização da Sociedade Civil",
                             Nível == "Não-Governamental/Organização da Sociedade Civil"~"Não Governamental/Organização da Sociedade Civil",
                             TRUE ~ Nível)) %>%
    filter(!is.na(Nível)) %>%
    mutate(Nível = factor(Nível, levels = c("Governamental",
                                            "Não Governamental/Organização da Sociedade Civil"))) %>%
    group_by(Categoria, Nível) %>%
    summarise(n=n()) %>%
    group_by(Categoria) %>%
    mutate(Percentual = n/sum(n))
}

grafico <- centrodia(cedia_2015, q6, "2015") %>%
  bind_rows(centrodia(cedia_2016, q4, "2016")) %>%
#  bind_rows(centrodia(cedia_2017, q4, "2017")) %>%
  bind_rows(centrodia(cedia_2018, q_4, "2018")) %>%
  bind_rows(centrodia(cedia_2019, q4, "2019")) %>%
  bind_rows(centrodia(cedia_2020, q4, "2020")) %>%
  bind_rows(centrodia(cedia_2021, q4, "2021")) %>%
# bind_rows(centrodia(cedia_2022, q4, "2022")) %>%
  bind_rows(centrodia(cedia_2023, q4, "2023")) %>%

  #2017 não identifiquei essa pergunta
  #2022 dados númericos

  f_grafico_col_stack_percent(Categoria, Percentual, Nível, 1)

grafico
```


Em relação a acessibilidade destas unidades, o banheiro acessivel é a adaptação mais nestas unidades chegando nos registros do Censo SUAS de 2022 com 73%. Como trata-se de unidades especializadas para atenção a pessoas com deficiência, esse item é de fundamental importância para assegurar acolhida e segurança a este público e suas famílias. O @fig-cdia-acessibilidade sinaliza os locais e composição de acessibilidade, estes dados sinalizam um desafio para garantir as condições físicas de acesso ao público de pessoas com deficiência nas unidades de Centro-Dia.


```{r fig-cdia-acessibilidade, fig.cap = "Evolução percentual de Centro-Dia com condições de acessibilidade - Brasil; 2015, 2018 e 2023", fig.footer = "Fonte: MDS, Censo SUAS."}

tabela <- equip_acessibilidade(cedia_2015, q20_1, "2015", "1") %>%
  bind_rows(equip_acessibilidade(cedia_2015, q20_2, "2015", "2")) %>%
  bind_rows(equip_acessibilidade(cedia_2015, q20_3, "2015", "3")) %>%
  bind_rows(equip_acessibilidade(cedia_2015, q20_4, "2015", "4")) %>%
  bind_rows(equip_acessibilidade(cedia_2018, q_19_1, "2018", "1")) %>%
  bind_rows(equip_acessibilidade(cedia_2018, q_19_2, "2018", "2")) %>%
  bind_rows(equip_acessibilidade(cedia_2018, q_19_3, "2018", "3")) %>%
  bind_rows(equip_acessibilidade(cedia_2018, q_19_4, "2018", "4")) %>%
  #bind_rows(equip_acessibilidade(cedia_2022, q15_1, "2022", "1")) %>%
  #bind_rows(equip_acessibilidade(cedia_2022, q15_2, "2022", "2")) %>%
  #bind_rows(equip_acessibilidade(cedia_2022, q15_3, "2022", "3")) %>%
  #bind_rows(equip_acessibilidade(cedia_2022, q15_4, "2022", "4")) %>%
  bind_rows(equip_acessibilidade(cedia_2023, q15_1, "2023", "1")) %>%
  bind_rows(equip_acessibilidade(cedia_2023, q15_2, "2023", "2")) %>%
  bind_rows(equip_acessibilidade(cedia_2023, q15_3, "2023", "3")) %>%
  bind_rows(equip_acessibilidade(cedia_2023, q15_4, "2023", "4")) %>%
  ungroup() %>%
  mutate(Categoria=str_wrap(Categoria,width=34))

ordenado<-tabela %>%
  filter(Ano == 2023) %>%
  arrange(Percentual) %>%
  pull(Categoria)

grafico<-tabela %>%
  mutate(Categoria = factor(Categoria, levels = ordenado)) %>%
  f_grafico_col_percent_flip(Categoria, Percentual, Ano, 1)

grafico
```


Além disto, há outras adaptações importantes nestas unidades, como tecnologias assistidas, suportes com materiais em braile, profissionais com conhecimento em Libras entre outros destacados no @fig-cdia_adaptacoes.



```{r fig-cdia_adaptacoes, fig.cap = "Quantidade de Centro-Dia, segundo outras adaptações - Brasil, 2015, 2018 e 2023", fig.footer = "Fonte: MDS, Censo SUAS."}
#| fig-height: 5

cdia_adp= function(df, q, ano, cod_categoria){
  q <- enquo(q)
  ano <- quo_name(ano)
  cod_categoria <- quo_name(cod_categoria)

#2022
  categoria <- case_when(!! cod_categoria == "1"~"Sim, suporte de profissional com conhecimento em LIBRAS",
                         !! cod_categoria == "2"~"Sim, suporte de material em braile",
                         !! cod_categoria == "3"~"Sim, suporte para leitores de telas de computador para pessoas com deficiência visual",
                         !! cod_categoria == "4"~"Sim, há outras adaptações ou estratégias para assegurar a acessibilidade as pessoas com deficiência auditiva/surdas e pessoas com deficiência visual",
                         !! cod_categoria == "5"~"Sim, outras adaptações e tecnologias assistivas para deficiência física",
                         !! cod_categoria == "6"~"Sim, outras adaptações e tecnologias assistivas para deficiência intelectual e autismo",
                         !! cod_categoria == "7"~"Sim, pisos especiais com relevos para sinalização voltados para pessoa com  deficiência visual",
                         !! cod_categoria == "0"~"Não há outras adaptações")


  df %>%
    select(!! q) %>%
    group_by(!! q) %>%
    summarise(n=n()) %>%
    mutate(Percentual = n/sum(n)) %>%
    filter(!! q == "Sim" | !! q == 1) %>%
    mutate("Categoria" = categoria, "Ano" = !! ano)
}

 tabela <- cdia_adp (cedia_2015,q21_1,"2015","1") %>%
  bind_rows(cdia_adp(cedia_2015,q21_2,"2015","2")) %>%
  bind_rows(cdia_adp(cedia_2015,q21_3,"2015","3")) %>%
  bind_rows(cdia_adp(cedia_2015,q21_4,"2015","5")) %>%
  bind_rows(cdia_adp(cedia_2015,q21_5,"2015","6")) %>%
  bind_rows(cdia_adp(cedia_2015,q21_6,"2015","7")) %>%
  bind_rows(cdia_adp(cedia_2015,q21_7,"2015","0")) %>%

  bind_rows(cdia_adp(cedia_2018,q_20_1,"2018","1")) %>%
  bind_rows(cdia_adp(cedia_2018,q_20_2,"2018","2")) %>%
  bind_rows(cdia_adp(cedia_2018,q_20_3,"2018","3")) %>%
  bind_rows(cdia_adp(cedia_2018,q_20_4,"2018","5")) %>%
  bind_rows(cdia_adp(cedia_2018,q_20_5,"2018","6")) %>%
  bind_rows(cdia_adp(cedia_2018,q_20_6,"2018","7")) %>%
  bind_rows(cdia_adp(cedia_2018,q_20_0,"2018","0")) %>%
   
# bind_rows(cdia_adp(cedia_2022,q16_1,"2022","1")) %>%
# bind_rows(cdia_adp(cedia_2022,q16_2,"2022","2")) %>%
# bind_rows(cdia_adp(cedia_2022,q16_3,"2022","3")) %>%
# bind_rows(cdia_adp(cedia_2022,q16_4,"2022","4")) %>%
# bind_rows(cdia_adp(cedia_2022,q16_5,"2022","5")) %>%
# bind_rows(cdia_adp(cedia_2022,q16_6,"2022","6")) %>%
# bind_rows(cdia_adp(cedia_2022,q16_7,"2022","7")) %>%
# bind_rows(cdia_adp(cedia_2022,q16_0,"2022","0")) %>%

  bind_rows(cdia_adp(cedia_2023,q16_1,"2023","1")) %>%
  bind_rows(cdia_adp(cedia_2023,q16_2,"2023","2")) %>%
  bind_rows(cdia_adp(cedia_2023,q16_3,"2023","3")) %>%
  bind_rows(cdia_adp(cedia_2023,q16_4,"2023","4")) %>%
  bind_rows(cdia_adp(cedia_2023,q16_5,"2023","5")) %>%
  bind_rows(cdia_adp(cedia_2023,q16_6,"2023","6")) %>%
  bind_rows(cdia_adp(cedia_2023,q16_7,"2023","7")) %>%
  bind_rows(cdia_adp(cedia_2023,q16_0,"2023","0")) %>%




  ungroup() %>%
  mutate(Categoria=str_wrap(Categoria,width=51))

ordenado<-tabela %>%
  filter(Ano == "2023") %>%
  arrange(Percentual) %>%
  pull(Categoria)

grafico<-tabela %>%
  mutate(Categoria = factor(Categoria, levels = ordenado)) %>%
  f_grafico_col_percent_flip(Categoria, Percentual, Ano, 1)

grafico
```


## Unidades de Alta Complexidade

As Unidades de Acolhimento tem o objetivo de ofertar serviços de Proteção Social Especial de Alta Complexidade, com atenção a pessoas e/ou famílias com vínculos rompidos ou fragilizados, ou que estejam em situação de abandono, ameaça ou violação de direitos, de forma a garantir sua proteção integral.

No que se refere à quantidade de Unidades de Acolhimento por porte populacional, destaca-se que há concentração nos municípios com porte populacional maiores. Todas as metrópoles possuem registro de mais de 10 unidades. O @fig-unac-porte também sinaliza que 74% dos municípios de pequeno porte I não dispõem de serviços de alta complexidade.

Para os municípios menores, a Resolução CNAS nº31/2013 aprova parametros para a oferta regionalizada e a expansão qualificada dos serviços de Alta Complexidade para Criança e Adolescentes. O orgão gestor estadual é responsável pela organização.

```{r fig-unac-porte, fig.cap = "Unidades de Acolhimento e estimativas da população para os municípios, segundo porte populacional - Brasil, 2023", fig.footer = "Fonte: MDS, Censo SUAS"}


unac_municipios <- unac_2023 %>%
  select(IBGE) %>%
  group_by(IBGE) %>%
  summarise(n_unac=n())

populacao <- pop_municipios_2017 %>%
  mutate(`COD. MUNIC` = str_sub(`COD. MUNIC`, end = 4)) %>%
  mutate(IBGE = as.numeric(paste0(`COD. UF`, `COD. MUNIC`))) %>%
  select(IBGE, `POPULAÇÃO ESTIMADA`)

dados <- unac_municipios %>%
  full_join(populacao, by = c("IBGE" = "IBGE")) %>%
  mutate(grupo = case_when(is.na(n_unac)~"Nenhuma Unidade de Acolhimento",
                            n_unac == 0~"Nenhuma Unidade de Acolhimento",
                            n_unac == 1~"1 Unidade de Acolhimento",
                            n_unac <= 3~"De 2 a 3 Unidades de Acolhimento",
                            n_unac <= 6~"De 4 a 6 Unidades de Acolhimento",
                            n_unac <= 10~"De 7 a 10 Unidades de Acolhimento",
                            n_unac > 10~"Mais de 10 Unidades de Acolhimento",
                            TRUE~as.character(n_unac))) %>%
  mutate(grupo = factor(grupo, levels = c("Nenhuma Unidade de Acolhimento",
                                            "1 Unidade de Acolhimento",
                                            "De 2 a 3 Unidades de Acolhimento",
                                            "De 4 a 6 Unidades de Acolhimento",
                                            "De 7 a 10 Unidades de Acolhimento",
                                            "Mais de 10 Unidades de Acolhimento"))) %>%
  filter(!is.na(`POPULAÇÃO ESTIMADA`)) %>%
  f_porte_populacional(`POPULAÇÃO ESTIMADA`) %>%
  group_by(Porte, grupo) %>%
  summarise(n=n()) #%>%
#  complete(grupo, fill = list(n=0))

niveis_porte <- dados$Porte %>%
  levels() %>%
  append("Brasil")

grafico <- dados %>%
  spread(Porte, n, fill = 0) %>%
  mutate("Brasil" = rowSums(.[2:6])) %>%
  gather("Porte","n",-grupo) %>%
  mutate(Porte = factor(Porte, levels = niveis_porte)) %>%
  group_by(Porte) %>%
  mutate("Percentual" = n/sum(n)) %>%

  f_grafico_col_stack_percent(Porte, Percentual, grupo, 3)

grafico
```


Quanto a natureza do acolhimento, a maioria das Unidades de Acolhimento são executadas por Organizações da Sociedade Cívil (Osc). Esse percentual teve uma redução entre 2012 e 2022. Em 2012 estes dados sinalizam percentual de 66,4% das unidades de acolhimento com execução de OSC, registrando em 2022 63,4% conforme o @fig-acolh_nat.


```{r fig-acolh_nat, fig.cap = "Quantitativo de Acolhimento Institucional por Natureza da Unidade - BRASIL, 2012 a 2023", fig.footer = "Fonte: MDS, Censo SUAS."}

acolh_nat  = function(df, q, ano){
  q <- enquo(q)
  ano <- quo_name(ano)

  df %>%
    select(!! ano := !! q) %>%
    gather("Categoria","Nível") %>%
    mutate(Nível = case_when(Nível == "Não Governamental"~"Não Governamental/Organização da Sociedade Civil",
                             Nível == "Não-Governamental"~"Não Governamental/Organização da Sociedade Civil",
                             Nível == "Governamental Municipal ou do Distrito Federal"~"Governamental",
                             Nível == "Governamental Estadual"~"Governamental",
                             Nível == "Não-Governamental/Organização da Sociedade Civil"~"Não Governamental/Organização da Sociedade Civil",
                             TRUE ~ Nível)) %>%
    filter(!is.na(Nível)) %>%
    mutate(Nível = factor(Nível, levels = c("Governamental",
                                            "Não Governamental/Organização da Sociedade Civil"))) %>%
    group_by(Categoria, Nível) %>%
    summarise(n=n()) %>%
    group_by(Categoria) %>%
    mutate(Percentual = n/sum(n))
}

grafico <- acolh_nat(unac_2012, q4, "2012") %>%
      bind_rows(acolh_nat(unac_2013, q4, "2013")) %>%
      bind_rows(acolh_nat(unac_2014, q5, "2014")) %>%
      bind_rows(acolh_nat(unac_2015, q5, "2015")) %>%
      bind_rows(acolh_nat(unac_2016, q4, "2016")) %>%
      bind_rows(acolh_nat(unac_2017, q3, "2017")) %>%
      bind_rows(acolh_nat(unac_2018, q_3, "2018")) %>%
      bind_rows(acolh_nat(unac_2019, q3, "2019")) %>%
      bind_rows(acolh_nat(unac_2020, q3, "2020")) %>%
      bind_rows(acolh_nat(unac_2021, q3, "2021")) %>%
      bind_rows(acolh_nat(unac_2022, q3, "2022")) %>%
      bind_rows(acolh_nat(unac_2023, q3, "2023")) %>%

  f_grafico_col_stack_percent(Categoria, Percentual, Nível, 1)

grafico
```


No que se refere às condições de acessibilidade, é possível notar no decorrer dos anos, em especial no ano de 2022. Entre as adaptação analisadas, as mais observadas são: rota acessível ao banheiro, presente em 50,9% das Unidades, e a menos observada é o acesso principal adaptado com rampas e rota acessível desde a calçada até o interior da unidade, presentes em 49,2% das Unidades. O banheiro adaptado para pessoas com deficiência e/ou mobilidade reduzida, presente em 47,9% das unidades em 2022 e no que se refere ao acesso principal adaptado com rampas e e rota acessivel para o Censo SUAS 2022 observa-se presente em 45,6% das unidades conforme o @fig-unac_acessibilidade.


```{r fig-unac_acessibilidade, fig.cap = "Evolução percentual de Unidades de Acolhimento Municipais com condições de acessibilidade - Brasil; 2017 e 2023", fig.footer = "Fonte: MDS, Censo SUAS"}

# Em 2012 não tem a informação sobre se a acessibilidade é de acordo com a Norma ABNT, esse detalhamento só tem a partir de 2015.
tabela <- equip_acessibilidade(unac_2015, q42_1, "2015", "1") %>%
  bind_rows(equip_acessibilidade(unac_2015, q42_2, "2015", "2")) %>%
  bind_rows(equip_acessibilidade(unac_2015, q42_3, "2015", "3")) %>%
  bind_rows(equip_acessibilidade(unac_2015, q42_4, "2015", "4")) %>%
  bind_rows(equip_acessibilidade(unac_2017, q37.1, "2017", "1")) %>%
  bind_rows(equip_acessibilidade(unac_2017, q37.2, "2017", "2")) %>%
  bind_rows(equip_acessibilidade(unac_2017, q37.3, "2017", "3")) %>%
  bind_rows(equip_acessibilidade(unac_2017, q37.4, "2017", "4")) %>%
  bind_rows(equip_acessibilidade(unac_2022, q41_1, "2022", "1")) %>%
  bind_rows(equip_acessibilidade(unac_2022, q41_2, "2022", "2")) %>%
  bind_rows(equip_acessibilidade(unac_2022, q41_3, "2022", "3")) %>%
  bind_rows(equip_acessibilidade(unac_2022, q41_4, "2022", "4")) %>%
  bind_rows(equip_acessibilidade(unac_2023, q49_1, "2023", "1")) %>%
  bind_rows(equip_acessibilidade(unac_2023, q49_2, "2023", "2")) %>%
  bind_rows(equip_acessibilidade(unac_2023, q49_3, "2023", "3")) %>%
  bind_rows(equip_acessibilidade(unac_2023, q49_4, "2023", "4")) %>%
  ungroup() %>%
  mutate(Categoria=str_wrap(Categoria,width=34))

ordenado<-tabela %>%
  filter(Ano == "2023") %>%
  arrange(Percentual) %>%
  pull(Categoria)

grafico<-tabela %>%
  mutate(Categoria = factor(Categoria, levels = ordenado)) %>%
  f_grafico_col_percent_flip(Categoria, Percentual, Ano, 1)

grafico
```


Em relação ao acesso à internet, é possível notar uma evolução nos últimos 10 anos. Em 2012 62,2% das unidades possuem acesso à internet, o Censo SUAS de 2022 destaca que 100% dos computadores das unidades possuem acesso à internet conforme o @fig-unac-internet.

```{r fig-unac-internet, fig.cap = "Percentual de Computadores nas unidades de Acolhimento com acesso à internet, 2013, 2018 e 2023", fig.footer = "Fonte: MDS, Censo SUAS."}


grafico <-
  #f_maior0_regiao_ano(unac_2012, q34a_2, Região, "2012") %>%
  f_maior0_regiao_ano(unac_2013, q35b_2, Região, "2013") %>%
  #bind_rows(f_maior0_regiao_ano(unac_2017, q36.20, IBGE, "2017")) %>%
  bind_rows(f_maior0_regiao_ano(unac_2018, q_39_23, IBGE, "2018")) %>% 
  # bind_rows(f_maior0_regiao_ano(unac_2022, q40_25, IBGE, "2022")) %>%
  bind_rows(f_maior0_regiao_ano(unac_2023, q48_27, IBGE, "2023")) %>%

  f_grafico_col_group_percent(Região, Percentual, Ano, 1)

grafico
```


## Unidades do Cadastro Único

Quanto a presença de unidades do Cadastro Único, os dados do Censo SUAS 2022 sinalizam 2.892 unidades, conforme pode ser observado através do @fig-postos-cadunico.


```{r fig-postos-cadunico, fig.cap = "Evolução de Postos do Cadastro Único - 2020 - 2021 - 2022 - 2023", fig.footer = "Fonte: MDS, Censo SUAS."}

grafico <- f_quantitativo_regiao_ano(posto_cadunico_2020, Regiao, "2020") %>%
  #bind_rows(f_quantitativo_regiao_ano(posto_cadunico_2021, IBGE, "2021")) %>%)
  bind_rows(f_quantitativo_regiao_ano(posto_cadunico_2022, IBGE, "2022")) %>%
  bind_rows(f_quantitativo_regiao_ano(posto_cadunico_2023, IBGE, "2023")) %>%
  f_grafico_col_group_numero(Região, n, Ano, 1)

  #ano 2021 não quer gerar, acho que pode ser erro no código do ibge

grafico
```


O @fig-posto_cadunico mostra o local onde estão estas unidades. A maioria delas, 61%, encontra-se na secretaria de Assistência Social. A segunda proporção são postos exclusivos, com destaque para algumas unidades presentes em escolas, conselhos e OSCS.


```{r fig-posto_cadunico, fig.cap = "Distribuição dos Postos do Cadastro Único - Brasil, 2020 a 2023", fig.footer = "Fonte: MDS, Censo SUAS."}
#| fig-height: 5

#revisar

posto_cadunico = function(df, q, ano){
  q <- enquo(q)
  ano <- quo_name(ano)

  df %>%
    select(!! ano := !! q) %>%
    gather("Grupo","Eixo_x") %>%
    mutate(Eixo_x = case_when(
      Eixo_x == "Sede da Secretaria da Assistência Social ou congênere;"~"Sede da Secretaria da Assistência Social ou congênere",
      Eixo_x == "Outra unidade administrativa (Sede da Prefeitura, Sede de Outra Secretaria, Administração Regional, Sub-Prefeituras," |
      Eixo_x == "Outra unidade administrativa (Sede da Prefeitura, Sede de Outra Secretaria, Administração Regional, Sub-Prefeituras, Un"~"Outra unidade administrativa (Sede da Prefeitura, Sede de Outra Secretaria, Administração Regional, Sub-Prefeituras, Unidades de outras políticas públicas, etc.)",
      Eixo_x == "Posto exclusivo para atendimento do Cadastro Único;"~"Posto exclusivo para atendimento do Cadastro Único",
      Eixo_x == "Serviço Integrado para o Cidadão (Na Hora, Vapt Vupt, Poupa Tempo, etc);"~"Serviço Integrado para o Cidadão (Na Hora, Vapt Vupt, Poupa Tempo, etc)",
      Eixo_x == "Escola"~"Escola",
      Eixo_x == "Entidade privada, Associação Comunitária ou ONG;"~"Entidade privada, Associação Comunitária ou ONG",
      Eixo_x == "Conselho Municipal de Assistência Social, Conselho Tutelar ou outro conselho municipal;"~"Conselho Municipal de Assistência Social, Conselho Tutelar ou outro conselho municipal",
      Eixo_x == "Outro."~"Outro",
      TRUE ~ Eixo_x)) %>%

    group_by(Grupo, Eixo_x) %>%
    summarise(n=n()) %>%
    mutate(Percentual = n/sum(n))
}

tabela <- posto_cadunico (posto_cadunico_2020, q1_0, "2020") %>%
  bind_rows(posto_cadunico(posto_cadunico_2021, q1, "2021")) %>%
  bind_rows(posto_cadunico(posto_cadunico_2022, q1, "2022")) %>%
  bind_rows(posto_cadunico(posto_cadunico_2023, q1, "2023")) %>%

  mutate(Eixo_x=str_wrap(Eixo_x,width=58))

ordenado<-tabela %>%
  filter(Grupo == "2023") %>%
  arrange(Percentual) %>%
  pull(Eixo_x)

grafico<-tabela %>%
  mutate(Eixo_x = factor(Eixo_x, levels = ordenado)) %>%
  f_grafico_col_percent_flip(Eixo_x, Percentual, Grupo, 1)

grafico
```


A acessibilidade nas unidades de Cadastro Único possuem pequeno avanço nos últimos anos, com execeção da rota acessível aos principais espaços, os demais itens de acessibilidade avançaram conforme pode ser observado através do @fig-postcad-acessibilidade.


```{r fig-postcad-acessibilidade, fig.cap = "Evolução percentual de postos do Cadastro Único com condições de acessibilidade - Brasil; 2020, 2021, 2022 e 2023", fig.footer = "Fonte: MDS, Censo SUAS."}

tabela <- equip_acessibilidade(posto_cadunico_2020, q7_1, "2020", "1") %>%
  bind_rows(equip_acessibilidade(posto_cadunico_2020, q7_2, "2020", "2")) %>%
  bind_rows(equip_acessibilidade(posto_cadunico_2020, q7_3, "2020", "3")) %>%
  bind_rows(equip_acessibilidade(posto_cadunico_2020, q7_4, "2020", "4")) %>%

  bind_rows(equip_acessibilidade(posto_cadunico_2021, q7_1, "2021", "1")) %>%
  bind_rows(equip_acessibilidade(posto_cadunico_2021, q7_2, "2021", "2")) %>%
  bind_rows(equip_acessibilidade(posto_cadunico_2021, q7_3, "2021", "3")) %>%
  bind_rows(equip_acessibilidade(posto_cadunico_2021, q7_4, "2021", "4")) %>%

  bind_rows(equip_acessibilidade(posto_cadunico_2022, q7_1, "2022", "1")) %>%
  bind_rows(equip_acessibilidade(posto_cadunico_2022, q7_2, "2022", "2")) %>%
  bind_rows(equip_acessibilidade(posto_cadunico_2022, q7_3, "2022", "3")) %>%
  bind_rows(equip_acessibilidade(posto_cadunico_2022, q7_4, "2022", "4")) %>%
  
   bind_rows(equip_acessibilidade(posto_cadunico_2023, q6_1, "2023", "1")) %>%
  bind_rows(equip_acessibilidade(posto_cadunico_2023, q6_2, "2023", "2")) %>%
  bind_rows(equip_acessibilidade(posto_cadunico_2023, q6_3, "2023", "3")) %>%
  bind_rows(equip_acessibilidade(posto_cadunico_2023, q6_4, "2023", "4")) %>%

  ungroup() %>%
  mutate(Categoria=str_wrap(Categoria,width=34))


ordenado<-tabela %>%
  filter(Ano == "2023") %>%
  arrange(Percentual) %>%
  pull(Categoria)

grafico<-tabela %>%
  mutate(Categoria = factor(Categoria, levels = ordenado)) %>%
  f_grafico_col_percent_flip(Categoria, Percentual, Ano, 1)

grafico
```


Em relação aos espaços de acessibilidade comparada a situação do imóvel, destaca-se que os postos do Cadastro Único próprios ou cedidos, possuem significativamente mais acessibilidade que os imóveis alugados (@fig-postcad-acessibilidade-situacao).

```{r fig-postcad-acessibilidade-situacao, fig.cap = "Percentual de Postos do Cadastro Único com condições de acessibilidade segundo situação do imóvel – Brasil, 2023", fig.footer = "Fonte: MDS, Censo SUAS."}

tabela <- equip_acessibilidade_situacao(posto_cadunico_2023, q4, q6_1, "1") %>%
  bind_rows(equip_acessibilidade_situacao(posto_cadunico_2023, q4, q6_2, "2")) %>%
  bind_rows(equip_acessibilidade_situacao(posto_cadunico_2023, q4, q6_3, "3")) %>%
  bind_rows(equip_acessibilidade_situacao(posto_cadunico_2023, q4, q6_4, "4"))

ordenado<-tabela %>%
  filter(Situacao == "Próprio") %>%
  arrange(Percentual) %>%
  pull(Categoria)

grafico<-tabela %>%
  mutate(Categoria = factor(Categoria, levels = rev(ordenado))) %>%
  f_grafico_col_group_percent(Situacao, Percentual, Categoria, 4)

grafico
```


Em relação a computadores com acesso à internet, os dados do Censo SUAS 2022 sinaliza que 99% das unidades dispõe de equipamentos com esta estrutura, conforme pode ser observado no @fig-postcad-internet-percentual.


```{r fig-postcad-internet-percentual, fig.cap = "Evolução percentual de Postos do Cadastro Único com computadores com acesso à internet – Brasil;  2020, 2021, 2022 e 2023", fig.footer = "Fonte: MDS, Censo SUAS."}

grafico <- f_maior0_regiao_ano(posto_cadunico_2020, q10_2, IBGE, "2020") %>%
  bind_rows(f_maior0_regiao_ano(posto_cadunico_2021, q10_2, IBGE, "2021")) %>%
  bind_rows(f_maior0_regiao_ano(posto_cadunico_2022, q10_2, IBGE, "2022")) %>%
  bind_rows(f_maior0_regiao_ano(posto_cadunico_2023, q8_2, IBGE, "2023")) %>%

  f_grafico_col_group_percent(Região, Percentual, Ano, 1)

grafico
```


## Considerações Finais

Na última década, o Censo SUAS 2022 revelou forte presença de unidades do SUAS no território Nacional. Foram identificadas 30.824 unidades da Assistência Social. São 8.557 CRAS, 7.837 Centro de Convivência, 2.846 CREAS, 33 CREAS Regionais, 237 Centro POP, 1.886 Centro-Dia, 2.892 unidades exclusivas de Cadastro Único e 6.536 unidades de acolhimento institucional (Crianças e adolescentes,Pessoas Idosas, Adultos e Famílias, Pessoas com deficiência, Mulheres em situação de Violência Doméstica, Jovens egressos serviços de acolhimento).Os dados mostram forte presença no território nacional com destaque para crescimentonos últimos 10 anos.

No âmbito da Proteção Básica houve um crescimento de 11%, nos últimos 10 anos. Em relação a acessibilidade há avanços, sobretudo os que possuem imóvel próprio que chegam a ter 28 pontos percentuais de diferença em relação aos imóveis alugados.

No que se refere à Proteção Social Especial, observou-se um crescimento das unidades CREAS (31%) e nas condições de acessibilidade, especialmente para as que possuem imóveis próprios, representando 28,4% de diferença em relação aos alugados. Os Centros POP cresceram tanto em unidades (126%) quanto na condição de acessibilidade nos imóveis próprios. Em relação às unidade de Acolhimento Institucional, 45% são da modalidade de Crianças e Adolescentes seguida de Pessoas Idosas e Adultos e Famílias. Os Centros-Dia, modalidade ofertada por 93% das OCS, também cresceram (41%), assim como suas condições de acessibilidade.

A oferta do Cadastro Único, em especial nas unidades dos CRAS, avançou 3,8 pontos percentuais nos últis 10 anos, esse dado se torna significativamente maior (25%) quando relacionado com equipe exclusiva para essa finalidade que avança 25 pontos percentuais neste mesmo período. Por fim, destaca-se a inclusão digital sob a ótica do acesso à internet como algo praticamente universalizado nas unidades do SUAS.
